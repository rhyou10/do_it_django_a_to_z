{% extends 'blog/base.html' %} 
{% load crispy_forms_tags %}

{% block head_title %}
    {{post.title}} - Blog
{% endblock %}

{% block main_area %}
 <!-- Post content-->
    <article>
    <!-- Post header-->
    <div id = 'post-area'>
        {% if post.category %}
            <spna class = 'badge badge-secondary float-right'>{{post.category}}</spna>
        {% else %}
            <span class = 'badge badge-secondary float-right'>미분류</span>
        {% endif %}
    <header class="mb-4" >
        <!-- Post title-->
        <h1 class="fw-bolder mb-1">{{post.title}}</h1>
        <h5 class="text-muted">{{post.hook_text}}</h5>
        <!-- Post autor-->
        <div class="text-muted fst-italic mb-2">by <a href ="#">{{post.author}}</a></div>

        <!--post_update-->
        {% if user.is_authenticated and user == post.author %}
            <a class="btn btn-info btn-sm float-right" href="/blog/update_post/{{post.pk}}/" role='button'><i class='fas fa-pen'></i> Edit Post</a>
        {% endif %}

        <!-- Post meta content-->
        <div class="text-muted fst-italic mb-2">{{post.created_at}}</div>
    </header>
    <!-- Preview image figure-->
    {% if post.head_image %}
    <figure class="mb-4"><img class="img-fluid rounded" src="{{post.head_image.url}}" alt="{{post.title}} head_image" /></figure>
    {% else %}
    <figure class="mb-4"><img class="img-fluid rounded" src="https://picsum.photos/seed/{{post.id}}/800/200" alt="random_image" /></figure>
    {% endif %}

    <!-- Post content-->
    <section class="mb-5">
        <p class="fs-5 mb-4">{{post.get_content_markdown | safe}}</p>
    </section>
    {% if post.tags.exists %}
        <i class = 'fas fa-tags'></i>
        {% for tag in post.tags.iterator %}
            <a href='{{tag.get_absolute_url}}'><span class="badge badge-pill badge-light">{{ tag }}</span></a>
        {% endfor %}
    {% endif %}
        </br>
        </br>   
    <!-- Post file download -->
    <!-- 포스트에 file이 있는경우 다운로드할수있는 btn 만든다. -->
    {% if post.file_upload %}
        <a href="{{post.file_upload.url}}" class = 'btn btn-outline-dark' role='butoon' download>Download:
            {% if post.get_file_ext == 'csv' %}
                <i class="fas fa-file-csv"></i>
            {% elif post.get_file_ext == 'xlsx' or post.get_file_ext == 'xls' %}
                <i class='fas fa-file-excel'></i>
            {% elif post.get_file_ext == 'docx' or post.get_file_ext == 'doc' %}
                <i class='fas fa-file-word'></i>
            {% else %}
                <i class='fas fa-file'></i>
            {% endif %}
            {{post.get_file_name}}
        </a>
    {% endif %}
    </br>
    </br>
</div>
</article>
<!-- Comments section-->

<div id='comment-area'>
<section class="mb-5">
    <div class="card bg-light">
        <div class="card-body">
            <!-- Comment form-->
            {% if user.is_authenticated %}
            <form id="comment-form" method="POST" action = "{{post.get_absolute_url}}new_comment/">
                {% csrf_token %}
                <div class="form-group">
                    <!--<textarea class="form-control" rows="3" placeholder="Join the discussion and leave a comment!"></textarea></form>-->
                    {{comment_form | crispy}}
                </div>
                <button type = 'submit' class='btn btn-primary'>Submit</button>
                <br>
                <br>
            {% else %}
                <a role='button' class = 'btn btn-outline-dark btn-block btn-sm' href='#' data-toggle='modal' data-target='#loginModal'>Login and leave a comment!</a>
                <br>
                <br>
            {% endif %}
            <!-- Comment with nested comments-->
                    {% if post.comment_set.exists %}
                    {% for comment in post.comment_set.iterator %}
                        <div class="d-flex mb-4" id = "comment-{{comment.pk}}">
                            <!-- Parent comment-->
                            <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..." /></div>
                            <div class="media-body">
                                <!-- 수정 버튼-->
                                {% if user.is_authenticated and comment.author == user %}
                                    <a role "button"
                                    class='btn btn-sm btn-info float-right'
                                    id="comment-{{comment.pk}} updatebtn"
                                    href="/blog/update_comment/{{comment.pk}}/">
                                    edit
                                </a>
                                {% endif %}
                                <div class="fw-bold">{{comment.author.username}} &nbsp;&nbsp; <small class="text-muted">{{comment.create_at}}</small></div>
                                <p>{{comment.content | linebreaks}}</p>
                            </div>
                        </div>
                    {% endfor %}
                    {% endif %}
                    <!-- Child comment 1
                    <div class="d-flex mt-4">
                        <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..." /></div>
                        <div class="ms-3">
                            <div class="fw-bold">Commenter Name</div>
                            And under those conditions, you cannot establish a capital-market evaluation of that enterprise. You can't get investors.
                        </div>
                    </div>

                    <div class="d-flex mt-4">
                        <div class="flex-shrink-0"><img class="rounded-circle" src="https://dummyimage.com/50x50/ced4da/6c757d.jpg" alt="..." /></div>
                        <div class="ms-3">
                            <div class="fw-bold">Commenter Name</div>
                            When you put money directly to a problem, it makes a good headline.
                        </div>
                    </div>
                -->
                
            </div>
            </div>
</section>
</div>

{% endblock %}